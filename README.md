# LLM Dou Dizhu Arena - 大模型斗地主对战平台

一个让AI大模型进行斗地主对战的平台，支持OpenAI GPT、Claude、Gemini等多个大模型，观看它们的智慧对决。

## 功能特性

### 🎮 完整的斗地主游戏引擎
- 标准斗地主规则实现
- 完整的牌型识别系统（单张、对子、三张、顺子、炸弹、火箭等）
- 叫地主机制
- 出牌合法性判断
- 胜负判定

### 🤖 多模型AI支持
- 支持OpenAI GPT系列模型
- 支持Anthropic Claude系列模型
- 支持Google Gemini系列模型
- 可扩展的模型接口，支持自定义模型

### 📊 数据统计与分析
- 模型胜率统计
- 地主/农民胜率分析
- 平均思考时间记录
- 平均回合数统计
- ELO评分系统（预留）

### 🎬 实时对战展示
- 实时游戏状态更新
- 玩家手牌数量显示
- 出牌历史记录
- 当前回合指示
- AI决策理由展示

### 📈 历史记录与回放
- 完整对战记录保存
- 对战历史查询
- 详细动作序列记录
- 游戏状态快照

## 技术架构

### 后端技术栈
- **Node.js + TypeScript**: 服务器端运行环境
- **tRPC**: 类型安全的API框架
- **Drizzle ORM**: 数据库ORM
- **MySQL/TiDB**: 数据存储
- **Express**: Web服务器

### 前端技术栈
- **React 19**: UI框架
- **Tailwind CSS 4**: 样式框架
- **shadcn/ui**: UI组件库
- **Wouter**: 路由管理
- **TanStack Query**: 数据获取和缓存

### AI集成
- **Manus LLM SDK**: 统一的LLM调用接口
- **Structured Output**: JSON Schema约束输出
- **Prompt Engineering**: 优化的决策提示词

## 快速开始

### 1. 初始化数据库

项目使用MySQL/TiDB作为数据库，数据库连接已通过环境变量自动配置。

运行数据库迁移：
```bash
pnpm db:push
```

### 2. 初始化AI模型数据

添加默认的AI模型配置：
```bash
pnpm exec tsx scripts/seed-models.mjs
```

这将添加以下模型：
- GPT-4 (OpenAI)
- Claude-3 (Anthropic)
- Gemini-Pro (Google)

### 3. 启动开发服务器

```bash
pnpm dev
```

服务器将在 `http://localhost:3000` 启动。

### 4. 访问应用

打开浏览器访问应用首页，点击"开始对战"即可配置并启动AI对战。

## 使用说明

### 开始对战

1. 进入"对战竞技场"页面
2. 从下拉菜单中选择三个不同的AI模型
3. 点击"开始对战"按钮
4. 系统将自动运行游戏，实时显示对战进度

### 查看统计

访问"统计数据"页面可以查看：
- 各模型的总体胜率
- 作为地主和农民的胜率
- 平均思考时间
- 平均回合数
- 模型排行榜

### 查看历史

访问"对战历史"页面可以：
- 浏览最近的对战记录
- 查看游戏详情
- 了解每局游戏的结果和时长

## 数据库结构

### ai_models - AI模型配置表
存储可用的AI模型信息，包括名称、提供商、模型ID等。

### games - 游戏记录表
存储每局游戏的基本信息，包括参战模型、地主位置、获胜者等。

### game_actions - 游戏动作表
存储游戏中的每个动作，包括叫地主、出牌、pass等，用于回放和分析。

### model_stats - 模型统计表
存储每个模型的统计数据，包括胜率、平均思考时间等。

## 游戏规则引擎

### 牌型识别
系统支持以下牌型：
- **单张**: 任意一张牌
- **对子**: 两张相同的牌
- **三张**: 三张相同的牌
- **三带一**: 三张相同 + 一张单牌
- **三带一对**: 三张相同 + 一对
- **顺子**: 至少5张连续的牌
- **连对**: 至少3对连续的对子
- **飞机**: 至少2组连续的三张
- **飞机带翅膀**: 飞机 + 相应数量的单牌或对子
- **四带二**: 四张相同 + 两张单牌或两对
- **炸弹**: 四张相同的牌
- **火箭**: 大王+小王（最大牌型）

### AI决策流程

1. **叫地主阶段**: AI根据手牌强度决定是否叫地主及叫分
2. **出牌阶段**: AI根据当前牌局状态、手牌、对手牌数等信息决策出牌
3. **决策约束**: 所有决策必须符合游戏规则，系统会验证合法性

### Prompt设计

AI决策使用精心设计的Prompt，包含：
- 当前游戏状态描述
- 手牌信息
- 对手信息
- 游戏规则说明
- 策略建议
- 结构化输出要求

## 测试

运行测试用例：
```bash
pnpm test
```

测试覆盖：
- 游戏引擎核心逻辑
- 牌型识别算法
- 出牌合法性判断
- 游戏状态管理

## 项目结构

```
llm_doudizhu_arena/
├── client/                 # 前端代码
│   ├── src/
│   │   ├── pages/         # 页面组件
│   │   ├── components/    # UI组件
│   │   └── lib/           # 工具函数
├── server/                 # 后端代码
│   ├── game/              # 游戏引擎
│   │   ├── cards.ts       # 扑克牌逻辑
│   │   ├── cardTypes.ts   # 牌型识别
│   │   ├── gameEngine.ts  # 游戏状态管理
│   │   ├── gameManager.ts # 游戏会话管理
│   │   └── aiPlayer.ts    # AI决策系统
│   ├── routers.ts         # tRPC路由
│   └── db.ts              # 数据库操作
├── drizzle/               # 数据库Schema
└── scripts/               # 工具脚本
```

## 开发计划

### 已完成
- ✅ 完整的斗地主游戏规则引擎
- ✅ 多模型AI集成
- ✅ 实时对战展示
- ✅ 数据统计分析
- ✅ 对战历史记录
- ✅ 游戏引擎单元测试

### 待开发
- ⏳ WebSocket实时通信
- ⏳ 对战回放功能
- ⏳ 游戏动画效果
- ⏳ 更多AI模型支持
- ⏳ ELO评分系统
- ⏳ 音效支持

## 贡献

欢迎提交Issue和Pull Request！

## 许可证

MIT License
